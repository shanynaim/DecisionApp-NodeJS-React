require("dotenv").config();
const Profile = require("../modules/profileModule");

const utils = require("../utils/helperMethods");
const mongoose = require("mongoose");

const { requiresAuth } = require("express-openid-connect");

const profile = async (req, res) => {
  debugger;
  const isAuthenticated = req.oidc.isAuthenticated();
  if (!isAuthenticated) {
    res
      .status(401)
      .send(new utils.Response(false, "user is not authenticated"));
  }
  const id = req.oidc.user.sub;

  const { profile } = req.body;
  if (!profile) {
    res.send(new utils.Response(false, "All fields required"));
  }

  const openness = "openness",
    conscientiousness = "conscientiousness",
    extraversion = "extraversion",
    agreeableness = "agreeableness",
    neuroticism = "neuroticism";
  try {
    await Profile.create({
      [openness]: profile[openness],
      [conscientiousness]: profile[conscientiousness],
      [extraversion]: profile[extraversion],
      [agreeableness]: profile[agreeableness],
      [neuroticism]: profile[neuroticism],

      user_id: id,
    });
    res.send(new utils.Response(true, { message: "profile created!" }));
  } catch (error) {
    console.log(error);
    res.send(new utils.Response(false, { message: "error" + error }));
  }
};

module.exports = { profile };
